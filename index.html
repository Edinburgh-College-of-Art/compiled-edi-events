<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Manchester Tech Meetups</title>
    <link rel="stylesheet" href="style.css">
    <!-- <link href="https://fonts.googleapis.com/css?family=Raleway|Poiret+One" rel="stylesheet"> -->
</head>

<body>
    <header>
        <h1>Manchester Tech Meetups</h1>
    </header>
    <summary>
        <p>Desc</p>
    </summary>
    <main>
        <div id="typeContainer">
            <div id="selected" class="type">
                <p>Event</p>
            </div>
            <div class="type">
                <p>Group</p>
            </div>
        </div>
        <div id="itemsContainer">
            <div id="eventContainer" class="itemsContainer">
                <!-- <nav id="eventsNav" class="itemsNav">
                    <div id="eventsSearchBar">Search</div>
                    <div id="eventsReduceBar">Reduce</div>
                    <div id="eventsSpecificBar">Specific</div>
                </nav> -->
                <section id="eventsItems">
                    <p>Events</p>
                </section>
            </div>
            <div id="groupContainer" class="itemsContainer" style="display:none;">
                <!-- <nav id="groupsNav" class="itemsNav">
                    <div id="groupsSearchBar">Search</div>
                    <div id="groupsReduceBar">Reduce</div>
                    <div id="groupsSpecificBar">Specific</div>
                </nav> -->
                <section id="groupsItems">
                    <p>Groups</p>
                </section>
            </div>
        </div>
    </main>
    <footer>Sean O'Mahoney</footer>

    <script type="text/javascript">
        const months = new Map([
            [1, 'January'],
            [2, 'February'],
            [3, 'March'],
            [4, 'April'],
            [5, 'May'],
            [6, 'June'],
            [7, 'July'],
            [8, 'August'],
            [9, 'September'],
            [10, 'October'],
            [11, 'November'],
            [12, 'December']
        ]);
        const abvMonths = new Map([
            [1, 'Jan'],
            [2, 'Feb'],
            [3, 'March'],
            [4, 'Apr'],
            [5, 'May'],
            [6, 'Jun'],
            [7, 'Jul'],
            [8, 'Aug'],
            [9, 'Sept'],
            [10, 'Oct'],
            [11, 'Nov'],
            [12, 'Dec']
        ]);
        const abvDays = new Map([
            [0, "Sun"],
            [1, "Mon"],
            [2, "Tue"],
            [3, "Wed"],
            [4, "Thur"],
            [5, "Fri"],
            [6, "Sat"]
        ]);

        function apsc(e) {
            return Array.prototype.slice.call(e)
        }

        window.addEventListener("load", function () {
            apsc(document.getElementsByClassName('type')).forEach((t, i) => {
                t.addEventListener('click', function () {
                    apsc(document.getElementsByClassName('type')).forEach((x) => {
                        x.setAttribute('id', '')
                    });
                    apsc(document.getElementsByClassName('itemsContainer')).forEach((x) => {
                        x.style.display = 'none'
                    });
                    t.setAttribute('id', 'selected');
                    document.getElementsByClassName('itemsContainer')[i].style.display =
                        'block';
                });
            })

            getData("_exports/events.json", data => {
                document.getElementById("eventsItems").innerHTML = data.map(eventHTML).join("");
            })

            getData("_exports/groups.json", data => {
                document.getElementById("groupsItems").innerHTML = data.map(groupHTML).join("");
            })

        });

        function eventHTML(event) {
            return `
                <div class="item">
                    <p class="date blue">${htmlDate(event.startTimeISO)}</p>
                    <h3 class="title"><a target="_blank" href="${event.link}">${event.name}</a></h3>
                    <p class="gray"><a target="_blank" href="${event.groupLink}">${event.groupName}</a> | ${event.source}</p>
                    <div class="locationDiv">
                        <img class="locationImg" src="./_static/img/location.svg">
                        <p class="location gray">${event.location || "Location Unavailable"}</p>
                    </div>
                </div>
            `
        }

        function groupHTML(group) {
            return `
            <div class="group"><a href="${group.link}" target="_blank">
                <div class="groupImg"><img src="${group.img || "http://www.afglaw.co.uk/wp-content/uploads/2018/07/blank-user.png"}"></div>
                <div class="groupText">
                    <p class="groupName">${group.name}</p>
                    <p>Members: ${group.members || "N/A"}<br>Source: ${group.source}</p>
                </div>
            </a></div>
            `
        }

        function htmlDate(string) {
            let date = new Date(string);
            return `${abvDays.get(date.getDay())}, ${abvMonths.get(date.getMonth())} ${date.getDate()}, ${timeConvert(date)}`;
        }

        function timeConvert(date) {
            let ampm, x, i =
                `${date.getHours() < 10 ? "0" + date.getHours() : date.getHours()}:${date.getMinutes() == 0 ? "00" : date.getMinutes()}`;
            if (i.substring(0, 2) > 12) {
                ampm = "PM";
                x = i.substring(0, 2) % 12 + ":" + i.substring(3, 5) + " " + ampm;
            } else {
                ampm = "AM";
                x = i.substring(0, 2) + ":" + i.substring(3, 5) + " " + ampm;
            }
            return x.substr(0, 1) == "0" ? x.slice(1) : x;
        }

        function getData(url, callback) {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let data = JSON.parse(this.responseText);
                    callback(data);
                }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [day, month, year].join('-');
        }
    </script>

</body>

</html>